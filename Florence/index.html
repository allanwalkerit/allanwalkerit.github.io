<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Hurricane Florence</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js'></script>
    <script src="https://public.tableau.com/javascripts/api/tableau-2.0.0.min.js" type="text/javascript"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />


    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<style>
.map-overlay {
    position: absolute;
    top: 0;
    left: 0;
    padding: 10px;
}

.map-overlay .map-overlay-inner {
width: 350px;
height: 200px;
background-color: rgba(0, 0, 0, 0.75);
border-radius: 3px;
border-top: : 3px solid #4264fb;
border-left: : 3px solid #4264fb;
border-right: : 3px solid #4264fb;
border-bottom: : 3px solid #4264fb;
box-shadow: 0 1px 2px rgba(0,0,0,0.10);
font-family: "Open Sans";
font-size: small !important; 
color: #4264fb !important;
padding: 10px;
}

.map-overlay h2 {
    line-height: 24px;
    display: block;
    margin: 0 0 10px;
}

.legend {
position: fixed;
right: 30px;
bottom: 30px;
height: 200px;
background-color: rgba(0, 0, 0, 0.75);
border-radius: 3px;
border-top: : 3px solid #4264fb;
border-left: : 3px solid #4264fb;
border-right: : 3px solid #4264fb;
border-bottom: : 3px solid #4264fb;
box-shadow: 0 1px 2px rgba(0,0,0,0.10);
font-family: "Open Sans";
font-size: small !important; 
color: #4264fb !important;
padding: 10px;
z-index: 1;
}

.tableau {
position: fixed;
width: 350px;
height: 200px;
right: 5px;
top: 5px;
background-color: rgba(0, 0, 0, 0.75);
border-radius: 3px;
border-top: : 3px solid #4264fb;
border-left: : 3px solid #4264fb;
border-right: : 3px solid #4264fb;
border-bottom: : 3px solid #4264fb;
box-shadow: 0 1px 2px rgba(0,0,0,0.10);
font-family: "Open Sans";
font-size: small !important; 
color: #4264fb !important;
padding: 10px;
z-index: 1;
}

.legend h4 {
    margin: 0 0 10px;
}

.a {
font-family: "Open Sans";
font-size: small !important; 
color: #ffffff !important; 
}


.map-overlay input {
    background-color: transparent;
    display: inline-block;
    width: 100%;
    position: relative;
    margin: 0;
    cursor: ew-resize;
}

.legend div span {
border-radius: 50%;
display: inline-block;
height: 10px;
width: 10px;
margin-right: 5px;
}

</style>

<div id='map'></div>
<div class="tableau" id="tableauViz1"></div>
<div class='map-overlay top'>
    <div class='map-overlay-inner'>
        <h2>Hurricane Florence</h2>
        <h4>Nexrad Level 2, Wilmington, NC 09-14-2018</h4>
        <label id='time'></label>
        <div id='new'></div>
        <br><br>
        <input id='slider' type='range' min='0' max='11' step='1' value='0' />
    </div>
    <div>
<div id='PopulationLegend' class='legend'>
<h4>Reflectivity</h4>
<div><span style='background-color: #3e4a89'></span>0</div>
<div><span style='background-color: #30668d'></span>3.9</div>
<div><span style='background-color: #25838e'></span>10.7</div>
<div><span style='background-color: #1e9e89'></span>17.5</div>
<div><span style='background-color: #35b779'></span>24.3</div>
<div><span style='background-color: #6cce59'></span>31.1</div>
<div><span style='background-color: #b5de2c'></span>37.9</div>
<div><span style='background-color: #fde725'></span>44.7</div>
<a href="https://www.ncdc.noaa.gov/nexradinv/">Data: NOAA NCEI</a>
</div>
    </div>
</div>




<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.0.0/d3.min.js' charset='utf-8'></script>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiYWxsYW53YWxrZXIiLCJhIjoiY2phbHVlOHQ4MnZscDMycGJoaTdiaHRxOCJ9.OYLAoMVg6e3Ih4r65WJuvA';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/dark-v9',
    center: [-77.777092, 33.414060],
    pitch: 60,
    zoom: 7.3
});

var times = [
    '2018-09-14T12:03:46Z',
    '2018-09-14T12:09:20Z',
    '2018-09-14T12:14:53Z',
    '2018-09-14T12:20:25Z',
    '2018-09-14T12:25:50Z',
    '2018-09-14T12:31:13Z',
    '2018-09-14T12:36:37Z',
    '2018-09-14T12:42:01Z',
    '2018-09-14T12:47:25Z',
    '2018-09-14T12:52:42Z',
    '2018-09-14T12:57:58Z',
    '2018-09-14T13:03:15Z'
];


function tableau() {
        var onePh = document.getElementById("tableauViz1");
        var oneUrl = "https://public.tableau.com/views/Florence_0/Dashboard1?";
var params="&:showVizHome=no&:display_spinner=y&:jsdebug=n&:embed=y&:display_overlay=no&:display_static_image=yes&:animate_transition=yes";
    var vizOptions = {
    width: "100%",
    height: "100%",
            hideTabs: false,
            onFirstInteractive: function() {
viz1.getWorkbook().changeParameterValueAsync("SweepTime", 0);
}
        };
viz1 = new tableauSoftware.Viz(onePh, oneUrl + params, vizOptions);
}

function filterBy(time) {

    var filters = ['==', 'sweepTime', time];
    map.setFilter('Florence', filters);
    document.getElementById('time').textContent = times[time];
}

// 

map.on('load', function() {
tableau();

map.addLayer({
        "id": "Florence",
        "type": 'fill-extrusion',
        'filter': ['==', 'sweepTime', '2018-09-14T12:03:46Z'],
        "source": {
            type: 'vector',
            url: 'mapbox://allanwalker.1gpde6zp'
        },
        "source-layer": "Florencegeojson",
        "paint": {
        'fill-extrusion-opacity': 0.75,
        'fill-extrusion-color': [
  "interpolate",
  ["linear"],
  ["get", "value"],
  0,
  "#3e4a89",
  3.9,
  "hsl(205, 49%, 37%)",
  10.7,
  "#25838e",
  17.5,
  "#1e9e89",
  24.3,
  "#35b779",
  31.1,
  "#6cce59",
  37.9,
  "#b5de2c",
  44.7,
  "#fde725"
],
            'fill-extrusion-height': ['get', 'heightASL'],
        }
    });
});

document.getElementById('new').innerHTML = "07:03:46";

        document.getElementById('slider').addEventListener('input', function(e) {
            var sliderval = parseInt(e.target.value, 10);


switch (sliderval) {
    case 0:
        time = "2018-09-14T12:03:46Z";
        local = "07:03:46";
        tableau = 1;
        break;
    case 1:
        time = "2018-09-14T12:09:20Z";
        local = "07:09:20";
        tableau = 2;
        break;
    case 2:
        time = "2018-09-14T12:14:53Z";
        local = "07:14:53";
        tableau = 3;
        break;
    case 3:
        time = "2018-09-14T12:20:25Z";
        local = "07:20:25";
        tableau = 4;
        break;
    case 4:
        time = "2018-09-14T12:25:50Z";
        local = "07:25:50";
        tableau = 5;
        break;
    case 5:
        time = "2018-09-14T12:31:13Z";
        local = "07:31:13";
        tableau = 6;
        break;
    case 6:
        time = "2018-09-14T12:36:37Z";
        local = "07:36:37";
        tableau = 7;
        break;
        case 7:
        time = "2018-09-14T12:42:01Z";
        local = "07:42:01";
        tableau = 8;
        break;
        case 8:
        time = "2018-09-14T12:47:25Z";
        local = "07:47:25";
        tableau = 9;
        break;
        case 9:
        time = "2018-09-14T12:52:42Z";
        local = "07:57:58";
        tableau = 10;
        break;
        case 10:
        time = "2018-09-14T12:57:58Z";
        local = "07:57:50";
        tableau = 11;
        break;
        case 11:
        time = "2018-09-14T13:03:15Z";
        local = "08:03:15";
        tableau = 12;
        
}
document.getElementById('new').innerHTML = local;
viz1.getWorkbook().changeParameterValueAsync("SweepTime", tableau);
filterBy(time);
        });
    ;
;
</script>

</body>
</html>