<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Pubnub Demo</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src='https://code.responsivevoice.org/responsivevoice.js'></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <script type="text/javascript" src="https://pubnub.github.io/eon/v/eon/1.0.0/eon.js"></script>
    <link type="text/css" rel="stylesheet" href="https://pubnub.github.io/eon/v/eon/1.0.0/eon.css"/>
<style>

body {
background-color:#000000;
}

.navbar-default {
background-color: #000000;
border-bottom: 0px;
border-top: 0px;
border-left: 0px;
border-right: 0px;
border-radius:0;
}

.navbar-brand {
  padding: 0px;
}
.navbar-brand>img {
  height: 100%;
  padding: 15px;
  width: auto;
}

#map {
height: 90vh;
width: 100%;
margin: 0 auto;
}

.mapboxgl-popup-content {
    color: #4264fb;
    background-color: #000000;
    border-color: #4264fb;
    border-width: 1px;
    max-width: 250px;
    font-family: "Open Sans";
}

.mapboxgl-popup-anchor-top .mapboxgl-popup-tip,
.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip,
.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {
    border-bottom-color: #4264fb;
    }
.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip,
.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip,
.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
    border-top-color: #4264fb;
    }
.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
    border-right-color: #4264fb;
    }
.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
    border-left-color: #4264fb;
    }

.mapboxgl-ctrl.mapboxgl-ctrl-attrib { 
    background-color:#000000; 
    border-top: : 1px solid #4264fb;
    border-left: : 1px solid #4264fb;
    border-right: : 1px solid #4264fb;
    border-bottom: : 0px solid #4264fb;
    border-radius: 15px 15px 0px 0px;
}

.mapboxgl-ctrl.mapboxgl-ctrl-attrib a {
font-family: "Open Sans";
color: #4264fb; 
}

p {
font-family: "Open Sans";
font-size: small !important; 
color: #4264fb !important;  
}

ul,li { 
list-style-type: none;
list-style-position:inside;
margin:0;
padding:0; 
}

.bannerhide {
height: 125px;
width: 95%;
overflow:hidden;
margin: 0 auto;
}

.btn .btn-info {
backgroud-color: #4264fb !important;    
}

.a {
font-family: "Open Sans";
font-size: small !important; 
color: #ffffff !important;  
}

</style>
</head>
<body>

<div id="main">
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
    <a class="navbar-brand"><img src="mapbox-logo.png" alt="Mapbox"></a>
    </div>
  </div>
</nav>

<div id="chart" class="container-fluid">
<div id ="DashboardsTop" class="row">
<div class="col-lg-12">
<div id='map'></div>
</div>


</div>
</div>
</div>

</body>

<script>
var pubnub = new PubNub({
  publishKey: 'pub-c-77466b86-4ad3-4d85-b6f1-f7635e5b1784',
  subscribeKey: 'sub-c-0f3354d4-f47e-11e8-b4b3-36001c7c3431'
});
var map = eon.map({
  id: 'map',
  mbId: 'mapbox.streets',
  mbToken: 'pk.eyJ1IjoiYWxsYW53YWxrZXIiLCJhIjoiY2phbHVlOHQ4MnZscDMycGJoaTdiaHRxOCJ9.OYLAoMVg6e3Ih4r65WJuvA',
  pubnub: pubnub,
  channels: ['sfo-flight-data'],
  rotate: true,
  history: true,
  marker: function (latlng, data) {

    var marker = new L.RotatedMarker(latlng, {
      icon: L.icon({
        iconUrl: 'airplane.png',
        iconSize: [24, 24]
      })
    });

    var popup = '';
    if(data[13]) {
      popup = 'Flight ' + data[13] + '';
    }
    if(data[11]) {
      if(!popup.length) {
        popup = 'Flight from ' + data[11];
      } else {
        popup += ' from ' + data[11];
      }
    }
    if(data[12]) {
      if(!popup.length) {
        popup = 'Flight to ' + data[12];
      } else {
        popup += ' to ' + data[12];
      }
    }
    if(!popup.length) {
      var popup = 'No data available';
    }

    marker.bindPopup(popup);

    return marker;

setInterval(function(){

  pubnub.publish({
    channel: 'sfo-flight-data',
    message:  
      {
        66e234a: {
           latlng: [
             37.6271,
             -122.3858
           ],
           data: [
             "A33D8C",
             37.6271,
             -122.3858,
             118,
             0,
             23,
             "3765",
             "F-KSJC3",
             "DC10",
             "N308FE",
             1433383239,
             "SFO",
             "MEM",
             "FX1345",
             1,
             0,
             "FDX1345",
             0
           ]
         },
         //...
      }
  });

}, 1000);
    
  }
});
</script>
</html>