<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>JLL 3D Mapping with Tableau</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js'></script>
    <script type="text/javascript" src="https://public.tableau.com/javascripts/api/tableau-2.js"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
        #tableauViz1 {height:325px; width:325px;margin: 0 auto; }
        #name {display:none;}
    </style>
</head>
<body>
<div id='name'></div>
<div id='map'></div>
<script>
var a = function tableau(){
     a = function tableau(){};
};

mapboxgl.accessToken = 'pk.eyJ1IjoiYWxsYW53YWxrZXIiLCJhIjoiY2phbHVlOHQ4MnZscDMycGJoaTdiaHRxOCJ9.OYLAoMVg6e3Ih4r65WJuvA';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v9',
    center: [-87.61694, 41.86625],
    zoom: 16.99,
    pitch: 40,
    bearing: 20
});

map.on('load', function() {
    map.addLayer({
        'id': 'room-extrusion',
        'type': 'fill-extrusion',
        'source': {
            'type': 'geojson',
            'data': 'https://www.mapbox.com/mapbox-gl-js/assets/indoor-3d-map.geojson'
        },
        'paint': {
            'fill-extrusion-color': ['get', 'color'],
            'fill-extrusion-height': ['get', 'height'],
            'fill-extrusion-base': ['get', 'base_height'],
            'fill-extrusion-opacity': 0.5
        }
    });
});



map.on('click', 'room-extrusion', function (e) {
        new mapboxgl.Popup()
            .setLngLat(map.unproject(e.point))
            .setHTML(e.features[0].properties.name+'<br>'+'<div id="tableauViz1"></div>')
            .addTo(map);
            document.getElementById("name").innerHTML = e.features[0].properties.name;
            tableau();
    });

function tableau() {
        var onePh = document.getElementById("tableauViz1");
        var oneUrl = "https://public.tableau.com/views/JLLPOC/Dashboard1?";
var params="&:showVizHome=no&:display_spinner=y&:jsdebug=n&:embed=y&:display_overlay=yes&:display_static_image=yes&:animate_transition=yes";
    var vizOptions = {
    width: "100%",
    height: "100%",
            hideTabs: false,
            onFirstInteractive: function() {
var x = document.getElementById("name").innerHTML;
viz1.getWorkbook().changeParameterValueAsync("Area", [x]);
}
        };
viz1 = new tableauSoftware.Viz(onePh, oneUrl + params, vizOptions);
}

</script>

</body>
</html>
